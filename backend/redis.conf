# ========================================================
# Redis Configuration for LensKart E-Commerce
# ========================================================
# This file provides recommended Redis configurations
# for optimal caching performance and security
# ========================================================

# ============ Network Configuration ============

# Bind to localhost for security (change in production)
bind 127.0.0.1

# Default port
port 6379

# Set timeout for idle clients (0 = no timeout)
timeout 300

# TCP keepalive (seconds)
tcp-keepalive 60

# ============ Memory Configuration ============

# Maximum memory Redis can use (adjust based on server)
maxmemory 256mb

# Eviction policy when maxmemory is reached
# allkeys-lru: Evict least recently used keys
# This is ideal for caching use case
maxmemory-policy allkeys-lru

# Number of samples for LRU/LFU algorithms
maxmemory-samples 5

# ============ Persistence Configuration ============

# For caching, we can disable persistence for better performance
# If you need persistence, uncomment these:

# save 900 1      # Save if at least 1 key changed in 900 seconds
# save 300 10     # Save if at least 10 keys changed in 300 seconds
# save 60 10000   # Save if at least 10000 keys changed in 60 seconds

# Disable RDB persistence for pure caching
save ""

# Disable AOF persistence for pure caching
appendonly no

# ============ Performance Tuning ============

# Lazy freeing (frees memory in background thread)
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
replica-lazy-flush yes

# Use jemalloc (default allocator)
# More efficient for Redis workload

# ============ Security Configuration ============

# Require password (set in production!)
# requirepass your-strong-password-here

# Disable dangerous commands in production
# rename-command FLUSHDB ""
# rename-command FLUSHALL ""
# rename-command CONFIG ""

# ============ Logging ============

# Log level: debug, verbose, notice, warning
loglevel notice

# Log file location (empty string = stdout)
logfile ""

# ============ Slow Log ============

# Log queries slower than this (microseconds)
slowlog-log-slower-than 10000

# Maximum length of slow log
slowlog-max-len 128

# ============ Client Connections ============

# Maximum number of connected clients
maxclients 10000

# ========================================================
# Environment-Specific Configuration
# ========================================================

# Development:
# - Lower maxmemory (128mb-256mb)
# - No persistence
# - Debug logging

# Production:
# - Higher maxmemory (1gb-4gb based on server)
# - Consider persistence if cache warmup is expensive
# - Enable requirepass
# - Warning/Notice logging
# - Monitor with redis-cli --stat

# ========================================================
# Usage Notes
# ========================================================

# 1. Start Redis with this config:
#    redis-server /path/to/redis.conf

# 2. Connect via redis-cli:
#    redis-cli -h 127.0.0.1 -p 6379

# 3. Monitor cache performance:
#    redis-cli INFO stats
#    redis-cli INFO memory
#    redis-cli --latency

# 4. Check hit rate:
#    redis-cli INFO stats | grep keyspace

# 5. Clear all cache (development only):
#    redis-cli FLUSHALL

# ========================================================
