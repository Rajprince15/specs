# Phase 5D: Error Handling & Logging Implementation

## Overview
This document describes the complete error handling and logging infrastructure implemented in Phase 5D.

## Backend Implementation

### 1. Structured JSON Logging

**File:** `/app/backend/logging_config.py`

#### Features:
- **JSON Format**: All logs are structured as JSON for easy parsing and analysis
- **Contextual Information**: Automatically includes timestamp, level, module, function, line number
- **Extra Fields**: Support for custom fields (user_id, request_id, endpoint, etc.)
- **Exception Tracking**: Automatic exception info capture with traceback
- **Environment-based**: Can switch between JSON and text format via environment variable

#### Configuration:
```python
# Environment Variables
JSON_LOGGING=true          # Enable JSON logging (default: false)
LOG_LEVEL=INFO            # Log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
```

#### Usage:
```python
from logging_config import get_logger

logger = get_logger(__name__, user_id="123", request_id="abc")
logger.info("User logged in", extra={'ip_address': '1.2.3.4'})
logger.error("Payment failed", extra={'order_id': 'xyz', 'amount': 99.99})
```

#### Example Log Output (JSON):
```json
{
  "timestamp": "2025-01-12T10:30:45.123456Z",
  "level": "INFO",
  "logger": "server",
  "message": "User logged in",
  "module": "server",
  "function": "login",
  "line": 582,
  "user_id": "user-123",
  "request_id": "abc-def-ghi",
  "endpoint": "/api/auth/login",
  "method": "POST",
  "status_code": 200,
  "duration_ms": 45.67
}
```

### 2. Error Tracking with Sentry

**File:** `/app/backend/error_tracking.py`

#### Features:
- **Automatic Exception Capture**: All unhandled exceptions sent to Sentry
- **Performance Monitoring**: Tracks API endpoint performance (configurable sample rate)
- **User Context**: Associates errors with specific users
- **Custom Context**: Add extra data to error reports
- **Integration**: FastAPI, Redis, and Logging integrations
- **Filtering**: Excludes health checks and static files
- **Decorator Support**: `@track_error` decorator for functions

#### Configuration:
```python
# Environment Variables
SENTRY_DSN=https://xxxxx@sentry.io/xxxxx  # Sentry DSN (required)
ENVIRONMENT=development                    # Environment name
APP_VERSION=1.0.0                         # App version for release tracking
SENTRY_TRACES_SAMPLE_RATE=0.1             # Performance monitoring sample rate
```

#### Usage:
```python
from error_tracking import capture_exception, set_user_context, track_error

# Manual exception capture
try:
    risky_operation()
except Exception as e:
    capture_exception(e, order_id="123", amount=99.99)

# Set user context for all subsequent errors
set_user_context(user_id="user-123", email="user@example.com")

# Decorator for automatic tracking
@track_error
async def process_payment(order_id):
    # Your code here
    pass
```

### 3. API Rate Limiting

**File:** `/app/backend/rate_limiter.py`

#### Features:
- **User-based Limiting**: Authenticated users tracked by user ID
- **IP-based Fallback**: Anonymous users tracked by IP address
- **Flexible Limits**: Per-minute, per-hour, per-day limits
- **Redis Storage**: Distributed rate limiting (optional)
- **Preset Limits**: Pre-configured limits for different endpoint types
- **Headers**: Includes rate limit info in response headers

#### Rate Limit Presets:
```python
RateLimit = {
    'auth': "5/minute",         # Login, logout
    'login': "10/minute",       # Login specifically
    'register': "5/minute",     # Registration
    'read': "100/minute",       # GET requests
    'search': "30/minute",      # Search endpoints
    'write': "30/minute",       # POST, PUT, DELETE
    'create': "20/minute",      # POST requests
    'update': "30/minute",      # PUT requests
    'delete': "20/minute",      # DELETE requests
    'payment': "5/minute",      # Payment operations
    'checkout': "3/minute",     # Checkout specifically
    'admin': "50/minute",       # Admin operations
    'default': "100/minute",    # Default for all endpoints
}
```

#### Configuration:
```python
# Environment Variables
REDIS_URL=redis://localhost:6379          # Redis for distributed limiting (optional)
DEFAULT_RATE_LIMIT=100/minute             # Global default limit
```

#### Usage:
```python
from rate_limiter import limiter, RateLimit

@api_router.post("/auth/login")
@limiter.limit(RateLimit['login'])
async def login(request: Request, credentials: UserLogin):
    # Endpoint code
    pass
```

#### Applied to Endpoints:
- `/api/auth/register` - 5 requests/minute
- `/api/auth/login` - 10 requests/minute
- `/api/payment/checkout` - 3 requests/minute
- All other endpoints - Default 100/minute

### 4. Request Tracking Middleware

**File:** `/app/backend/middleware.py`

#### Features:
- **Request ID**: Unique ID for each request (UUID)
- **Performance Tracking**: Measures request duration
- **Response Headers**: Adds X-Request-ID and X-Process-Time headers
- **Automatic Logging**: Logs all requests with context
- **Error Handling**: Catches and logs unhandled errors

#### Example Request Log:
```json
{
  "timestamp": "2025-01-12T10:30:45.123456Z",
  "level": "INFO",
  "message": "POST /api/auth/login",
  "request_id": "abc-def-ghi-jkl",
  "method": "POST",
  "endpoint": "/api/auth/login",
  "status_code": 200,
  "duration_ms": 45.67,
  "user_agent": "Mozilla/5.0..."
}
```

### 5. Error Handler Middleware

#### Features:
- **Global Error Catching**: Catches all unhandled exceptions
- **Consistent Responses**: Returns standardized error JSON
- **Error Logging**: Logs full exception details with traceback
- **Request Context**: Includes request ID in error response

#### Example Error Response:
```json
{
  "error": "Internal server error",
  "message": "An unexpected error occurred. Please try again later.",
  "request_id": "abc-def-ghi-jkl"
}
```

### 6. Request Validation

**Pydantic Models** are used throughout for automatic request validation:
- Type checking
- Required field validation
- Value constraints (min/max, regex patterns)
- Custom validators
- Automatic error messages

Example validation error response:
```json
{
  "detail": [
    {
      "loc": ["body", "email"],
      "msg": "value is not a valid email address",
      "type": "value_error.email"
    }
  ]
}
```

## Frontend Implementation

### 1. Error Boundary Component

**File:** `/app/frontend/src/components/ErrorBoundary.js`

#### Features:
- **React Error Catching**: Catches JavaScript errors in component tree
- **Graceful Fallback**: Shows user-friendly error UI
- **Development Info**: Shows stack trace in development mode
- **Error Recovery**: "Try Again" button to reset error state
- **Sentry Integration**: Automatically reports errors to Sentry (if configured)
- **Custom Fallback**: Supports custom fallback UI via props

#### Usage:
```jsx
// Wraps entire app
<ErrorBoundary>
  <App />
</ErrorBoundary>

// With custom fallback
<ErrorBoundary fallback={<CustomErrorUI />}>
  <YourComponent />
</ErrorBoundary>
```

### 2. Toast Notification System

**File:** `/app/frontend/src/components/Toast.js`

#### Features:
- **4 Types**: success, error, warning, info
- **Auto-dismiss**: Configurable duration (default 5 seconds)
- **Manual Dismiss**: Close button on each toast
- **Stacking**: Multiple toasts stack vertically
- **Animations**: Smooth slide-in animations
- **Icons**: Contextual icons for each type
- **Accessible**: ARIA live regions for screen readers

#### Usage:
```jsx
import { useToast } from '@/components/Toast';

function MyComponent() {
  const { toast } = useToast();

  const handleSuccess = () => {
    toast.success('Success!', 'Operation completed successfully');
  };

  const handleError = () => {
    toast.error('Error!', 'Something went wrong', 10000); // 10 seconds
  };

  const handleWarning = () => {
    toast.warning('Warning!', 'Please check your input');
  };

  const handleInfo = () => {
    toast.info('Info', 'Just so you know...');
  };

  return (
    // Your component
  );
}
```

### 3. Loading Skeleton Components

**File:** `/app/frontend/src/components/LoadingSkeleton.js`

#### Features:
- **Base Skeleton**: Generic skeleton component
- **Specialized Skeletons**: Pre-built for common UI patterns
- **Smooth Animation**: Gradient pulse animation
- **Variants**: Rectangular, circular, text
- **Responsive**: Works with all screen sizes

#### Available Components:
- `Skeleton` - Base skeleton component
- `ProductCardSkeleton` - Product card loading state
- `ProductDetailSkeleton` - Product detail page loading
- `ListSkeleton` - List items loading (configurable count)
- `TableSkeleton` - Table loading (configurable rows/cols)
- `CardSkeleton` - Generic card loading
- `FormSkeleton` - Form loading (configurable fields)
- `PageSkeleton` - Full page loading

#### Usage:
```jsx
import { ProductCardSkeleton, ListSkeleton } from '@/components/LoadingSkeleton';

function ProductList() {
  const [loading, setLoading] = useState(true);
  const [products, setProducts] = useState([]);

  if (loading) {
    return (
      <div className="grid grid-cols-3 gap-4">
        <ProductCardSkeleton />
        <ProductCardSkeleton />
        <ProductCardSkeleton />
      </div>
    );
  }

  return (
    // Your products
  );
}
```

## Integration in App

### Backend (server.py)

```python
from logging_config import setup_logging, get_logger
from error_tracking import initialize_sentry
from rate_limiter import create_limiter, RateLimit
from middleware import RequestTrackerMiddleware, ErrorHandlerMiddleware

# Setup logging
setup_logging(log_level='INFO', json_format=True)
logger = get_logger(__name__)

# Initialize Sentry
if os.getenv('SENTRY_DSN'):
    initialize_sentry(
        dsn=os.getenv('SENTRY_DSN'),
        environment='production',
        traces_sample_rate=0.1,
    )

# Create rate limiter
limiter = create_limiter(default_limit="100/minute")
app.state.limiter = limiter

# Add middleware
app.add_middleware(RequestTrackerMiddleware)
app.add_middleware(ErrorHandlerMiddleware)
```

### Frontend (App.js)

```jsx
import ErrorBoundary from '@/components/ErrorBoundary';
import { ToastProvider } from '@/components/Toast';

function App() {
  return (
    <ErrorBoundary>
      <ToastProvider>
        <HelmetProvider>
          {/* Your app */}
        </HelmetProvider>
      </ToastProvider>
    </ErrorBoundary>
  );
}
```

## Environment Variables

### Backend (.env)

```bash
# Logging
JSON_LOGGING=true                                    # Enable JSON logging
LOG_LEVEL=INFO                                       # Log level

# Sentry Error Tracking
SENTRY_DSN=https://xxxxx@sentry.io/xxxxx            # Sentry DSN (optional)
ENVIRONMENT=production                               # Environment name
APP_VERSION=1.0.0                                    # App version
SENTRY_TRACES_SAMPLE_RATE=0.1                       # Performance sample rate

# Rate Limiting
REDIS_URL=redis://localhost:6379                     # Redis for distributed limiting (optional)
DEFAULT_RATE_LIMIT=100/minute                        # Global default limit
```

## Testing

### Test Rate Limiting:
```bash
# Test login rate limit (should fail after 10 requests)
for i in {1..15}; do
  curl -X POST http://localhost:8001/api/auth/login \
    -H "Content-Type: application/json" \
    -d '{"email":"test@example.com","password":"test123"}'
done
```

### Test Error Tracking:
```python
# Manually trigger error
raise Exception("Test exception for Sentry")

# Check Sentry dashboard for the error report
```

### Test Logging:
```bash
# View logs (JSON format)
tail -f /var/log/supervisor/backend.out.log | jq .

# Filter by level
tail -f /var/log/supervisor/backend.out.log | jq 'select(.level=="ERROR")'

# Filter by endpoint
tail -f /var/log/supervisor/backend.out.log | jq 'select(.endpoint=="/api/auth/login")'
```

### Test Error Boundary:
```jsx
// Add this to any component to trigger error
const TestError = () => {
  throw new Error('Test error boundary');
  return null;
};

// Use in app
<TestError />
```

### Test Toast:
```jsx
// Add to any component
const { toast } = useToast();

<button onClick={() => toast.success('Test', 'This is a test')}>
  Test Toast
</button>
```

## Benefits

### Development:
- âœ… Better debugging with structured logs
- âœ… Clear error messages and stack traces
- âœ… Request tracing with unique IDs
- âœ… Performance insights

### Production:
- âœ… Centralized error tracking with Sentry
- âœ… Rate limiting prevents abuse
- âœ… Better user experience with error boundaries
- âœ… Consistent error handling
- âœ… Log aggregation and analysis

### Monitoring:
- âœ… Track API performance
- âœ… Monitor error rates
- âœ… Identify problematic endpoints
- âœ… User behavior insights

## Future Enhancements

1. **Log Aggregation**: Integrate with ELK stack, Datadog, or CloudWatch
2. **Alert System**: Set up alerts for error rates and critical errors
3. **Retry Logic**: Implement automatic retry for failed requests
4. **Circuit Breaker**: Prevent cascading failures
5. **Request Replay**: Save and replay failed requests
6. **Performance Metrics**: Add custom performance metrics
7. **User Session Tracking**: Track full user journeys
8. **A/B Testing Integration**: Track errors by experiment variant

## Maintenance

### Regular Tasks:
1. Review error logs weekly
2. Monitor rate limit violations
3. Check Sentry dashboard for trends
4. Update rate limits based on usage patterns
5. Rotate log files to prevent disk fill
6. Review and update error messages

### When Issues Occur:
1. Check logs with request ID for full context
2. Review Sentry for detailed error reports
3. Check rate limit headers in responses
4. Verify middleware is properly configured
5. Test error scenarios in development

## Summary

Phase 5D implements a comprehensive error handling and logging infrastructure with:

âœ… **Backend:**
- Structured JSON logging
- Sentry error tracking
- API rate limiting
- Request tracking middleware
- Automatic error handling
- Request validation

âœ… **Frontend:**
- Error boundary components
- Toast notification system
- Loading skeleton components
- Graceful error recovery

This provides a robust foundation for monitoring, debugging, and maintaining the application in production.





# ğŸ“‹ Logging System Explanation - Phase 5D

## ğŸ¯ How the Logging System Works

### Overview
The application uses a **file-based logging system** with optional cloud error tracking. Logs are **NOT stored in the database** but are written to log files managed by the supervisor process.

---

## ğŸ“ Where Logs Are Saved

### 1. **Local Log Files (Primary Storage)**

All application logs are written to supervisor log files:

```
/var/log/supervisor/backend.out.log    # Standard output (info, debug logs)
/var/log/supervisor/backend.err.log    # Standard error (error, critical logs)
```

**How it works:**
1. Application code uses Python's `logging` module
2. Logs are formatted as JSON (if JSON_LOGGING=true) or plain text
3. Logs are written to STDOUT/STDERR
4. Supervisor captures STDOUT/STDERR and writes to log files
5. Log files are rotated automatically by supervisor

### 2. **Sentry (Optional Cloud Service)**

If configured with SENTRY_DSN, errors are also sent to Sentry's cloud service:
- **What:** Cloud-based error tracking and monitoring platform
- **Purpose:** Centralized error tracking, alerting, and analysis
- **Stored:** Sentry cloud (separate from your database)
- **Access:** Via Sentry dashboard (sentry.io)

---

## ğŸ”„ Log Flow Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Application Code   â”‚
â”‚  (FastAPI/Python)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  logging_config.py  â”‚ â—„â”€â”€ Structured JSON Formatter
â”‚  (JSON Formatter)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Python Logger      â”‚
â”‚  (STDOUT/STDERR)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                          â”‚
           â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supervisor         â”‚   â”‚  Sentry             â”‚
â”‚  (Process Manager)  â”‚   â”‚  (Optional Cloud)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Log Files          â”‚
â”‚  /var/log/supervisorâ”‚
â”‚  - backend.out.log  â”‚
â”‚  - backend.err.log  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Is It Connected to the Database?

### âŒ **NO - Logs Are NOT Stored in Database**

**Why:**
- **Performance:** Writing logs to files is much faster than database writes
- **Reliability:** If database fails, logs still work
- **Separation of Concerns:** Application data â‰  operational logs
- **Best Practice:** Industry standard to use file-based logging

**What IS in the database:**
- User data (users, products, orders, etc.)
- Application data (cart items, reviews, wishlist, etc.)
- Business data (payment transactions, addresses, etc.)

**What is NOT in the database:**
- Application logs (info, debug, warning messages)
- Request/response logs
- Error stack traces
- Performance metrics

---

## ğŸ“Š Log Structure (JSON Format)

### Example Log Entry:

```json
{
  "timestamp": "2025-01-12T10:30:45.123456Z",
  "level": "INFO",
  "logger": "server",
  "message": "User logged in successfully",
  "module": "server",
  "function": "login",
  "line": 582,
  "request_id": "abc-def-ghi-jkl",
  "user_id": "user-123",
  "endpoint": "/api/auth/login",
  "method": "POST",
  "status_code": 200,
  "duration_ms": 45.67,
  "user_agent": "Mozilla/5.0..."
}
```

### Log Levels:
- **DEBUG:** Detailed diagnostic information
- **INFO:** General informational messages (requests, responses)
- **WARNING:** Warning messages (non-critical issues)
- **ERROR:** Error messages (exceptions, failures)
- **CRITICAL:** Critical errors (system failures)

---

## ğŸ”§ Configuration (Environment Variables)

### Backend .env Configuration:

```bash
# ============================================
# Logging Configuration
# ============================================

# Enable JSON-formatted logging (true/false)
# - true: Logs in JSON format (recommended for production)
# - false: Logs in plain text format (easier to read in development)
JSON_LOGGING=true

# Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
# - DEBUG: Most verbose (all logs)
# - INFO: Standard operational logs (recommended)
# - WARNING: Only warnings and errors
# - ERROR: Only errors and critical
# - CRITICAL: Only critical failures
LOG_LEVEL=INFO

# ============================================
# Sentry Error Tracking (Optional)
# ============================================

# Sentry DSN (Data Source Name)
# - Get this from your Sentry.io project settings
# - Leave empty to disable Sentry
# - Example: https://xxxxx@o1234567.ingest.sentry.io/1234567
SENTRY_DSN=

# Environment name for Sentry
# - development: Local development
# - staging: Staging environment
# - production: Production environment
ENVIRONMENT=development

# Application version for Sentry release tracking
APP_VERSION=1.0.0

# Performance monitoring sample rate (0.0 to 1.0)
# - 0.0: No performance monitoring
# - 0.1: Monitor 10% of requests (recommended)
# - 1.0: Monitor 100% of requests (not recommended in production)
SENTRY_TRACES_SAMPLE_RATE=0.1

# ============================================
# Rate Limiting Configuration
# ============================================

# Redis URL for distributed rate limiting
# - Leave empty to use in-memory storage (single server)
# - Use Redis for multi-server deployments
REDIS_URL=redis://localhost:6379

# Default rate limit for all endpoints
# - Format: "X/minute" or "X/hour" or "X/day"
# - Example: "100/minute" = 100 requests per minute
DEFAULT_RATE_LIMIT=100/minute
```

---

## ğŸ“– How to View Logs

### 1. **View Real-time Logs:**

```bash
# View all backend logs (real-time)
tail -f /var/log/supervisor/backend.out.log

# View error logs only
tail -f /var/log/supervisor/backend.err.log

# View last 100 lines
tail -n 100 /var/log/supervisor/backend.out.log

# View logs with JSON formatting (requires jq)
tail -f /var/log/supervisor/backend.out.log | jq .
```

### 2. **Filter Logs:**

```bash
# Filter by log level (ERROR)
tail -f /var/log/supervisor/backend.out.log | jq 'select(.level=="ERROR")'

# Filter by endpoint
tail -f /var/log/supervisor/backend.out.log | jq 'select(.endpoint=="/api/auth/login")'

# Filter by user
tail -f /var/log/supervisor/backend.out.log | jq 'select(.user_id=="user-123")'

# Filter by request ID (trace a specific request)
tail -f /var/log/supervisor/backend.out.log | jq 'select(.request_id=="abc-def-ghi")'
```

### 3. **Search Logs:**

```bash
# Search for specific text
grep "User logged in" /var/log/supervisor/backend.out.log

# Search for errors
grep "ERROR" /var/log/supervisor/backend.err.log

# Search for specific user
grep "user-123" /var/log/supervisor/backend.out.log

# Count occurrences
grep -c "Payment successful" /var/log/supervisor/backend.out.log
```

---

## ğŸš¨ Error Tracking with Sentry (Optional)

### What is Sentry?
- **Cloud-based error tracking service** (not part of your infrastructure)
- Automatically captures and reports errors
- Provides error alerts, stack traces, and debugging information
- Tracks error frequency and trends
- Groups similar errors together

### How to Set Up Sentry:

1. **Create Account:**
   - Go to [sentry.io](https://sentry.io)
   - Sign up for free account (free tier available)

2. **Create Project:**
   - Create new project in Sentry
   - Select "Python" as platform
   - Copy the DSN (Data Source Name)

3. **Configure Application:**
   - Add DSN to backend .env file:
     ```bash
     SENTRY_DSN=https://xxxxx@o1234567.ingest.sentry.io/1234567
     ```

4. **Restart Backend:**
   - Restart backend server to apply changes
   - Errors will now be sent to Sentry

5. **View Errors:**
   - Log in to Sentry dashboard
   - View errors, stack traces, and debugging info

### When to Use Sentry:
- âœ… **Production environments** (highly recommended)
- âœ… **Staging environments** (recommended)
- âŒ **Development environments** (optional, usually not needed)

---

## ğŸ“ˆ What Gets Logged?

### Automatic Logging (via Middleware):

1. **All HTTP Requests:**
   - Request method (GET, POST, PUT, DELETE)
   - Endpoint path (/api/products, /api/auth/login)
   - Status code (200, 404, 500)
   - Request duration (in milliseconds)
   - User agent (browser information)
   - Request ID (unique identifier)

2. **All Errors:**
   - Exception type and message
   - Full stack trace
   - Request context (endpoint, method, user)
   - Request ID for tracing

3. **Rate Limiting:**
   - Rate limit violations
   - User/IP being rate limited
   - Endpoint being protected

### Manual Logging (in your code):

```python
from logging_config import get_logger

logger = get_logger(__name__)

# Info logging
logger.info("User created order", extra={'order_id': order_id, 'amount': total})

# Warning logging
logger.warning("Low stock alert", extra={'product_id': product_id, 'stock': stock})

# Error logging
try:
    risky_operation()
except Exception as e:
    logger.error("Operation failed", extra={'error': str(e)}, exc_info=True)
```

---

## ğŸ” Request Tracking

### Request ID System:

Every request gets a **unique Request ID** (UUID):
- Generated automatically by `RequestTrackerMiddleware`
- Added to response headers: `X-Request-ID`
- Included in all log entries for that request
- Used to trace a request through the system

**Example workflow:**
1. User makes request to `/api/products`
2. Middleware generates request ID: `abc-def-ghi-jkl`
3. All logs for this request include this ID
4. Response includes header: `X-Request-ID: abc-def-ghi-jkl`
5. If error occurs, you can trace it using request ID

**How to trace a request:**
```bash
# Get request ID from error or response header
REQUEST_ID="abc-def-ghi-jkl"

# View all logs for that request
grep "$REQUEST_ID" /var/log/supervisor/backend.out.log | jq .
```

---

## ğŸ’¾ Log Rotation

Supervisor automatically manages log rotation:
- **When:** Logs are rotated when they reach a certain size
- **How many:** Keeps multiple backup files
- **Old logs:** Automatically deleted after retention period

**Default configuration (in supervisord.conf):**
```ini
stdout_logfile=/var/log/supervisor/backend.out.log
stdout_logfile_maxbytes=50MB        # Rotate when 50MB
stdout_logfile_backups=10           # Keep 10 backups
stderr_logfile=/var/log/supervisor/backend.err.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=10
```

---

## ğŸ¯ Best Practices

### Development:
- âœ… Use `LOG_LEVEL=DEBUG` for detailed logs
- âœ… Use `JSON_LOGGING=false` for easier reading
- âŒ Don't enable Sentry (not needed)
- âœ… Monitor logs with `tail -f`

### Production:
- âœ… Use `LOG_LEVEL=INFO` (balance between detail and noise)
- âœ… Use `JSON_LOGGING=true` (for log aggregation tools)
- âœ… Enable Sentry for error tracking
- âœ… Use log aggregation service (ELK, Datadog, CloudWatch)
- âœ… Set up alerts for critical errors
- âœ… Monitor log file sizes

### Debugging:
- âœ… Always include request ID when reporting issues
- âœ… Use structured logging with extra fields
- âœ… Log at appropriate levels (don't log everything as ERROR)
- âœ… Include relevant context in log messages

---

## ğŸ” Security Considerations

### What NOT to Log:
- âŒ Passwords (plain text)
- âŒ Credit card numbers
- âŒ API keys or secrets
- âŒ Personal identifiable information (unless necessary)
- âŒ Session tokens

### What IS Safe to Log:
- âœ… User IDs (UUIDs)
- âœ… Request IDs
- âœ… Endpoint paths
- âœ… HTTP status codes
- âœ… Request duration
- âœ… Error messages (without sensitive data)

---

## ğŸ“Š Summary

### Key Points:
1. âœ… **Logs are saved to files:** `/var/log/supervisor/backend.*.log`
2. âŒ **Logs are NOT in database:** Files only (performance + reliability)
3. âœ… **JSON format:** Structured logging for easy parsing
4. âœ… **Request tracking:** Every request has unique ID
5. âœ… **Optional Sentry:** Cloud error tracking (recommended for production)
6. âœ… **Rate limiting:** Prevent API abuse
7. âœ… **Error boundaries:** Frontend error handling

### Configuration Required:
- **Minimum:** `LOG_LEVEL=INFO`, `JSON_LOGGING=true`
- **Recommended:** Add `SENTRY_DSN` for error tracking
- **Production:** Add `REDIS_URL` for distributed rate limiting

### No Database Connection:
Logging system is **completely independent** of your MySQL database. Logs flow from application â†’ supervisor â†’ log files, with optional cloud backup to Sentry.

---

**Last Updated:** 2025-01-12
**Phase:** 5D - Error Handling & Logging
**Status:** âœ… Complete
